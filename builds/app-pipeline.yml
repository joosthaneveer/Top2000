name: $(major).$(minor).$(Year:yy)$(DayOfYear).$(rev:rr)

variables:
- group: Top-2000-variable-group
- group: shared-infra
- name: major
  value: 6
- name: minor
  value: 4
- name: product
  value: 'TOP2000'
- name: uwp-version
  value: $(major).$(minor).$[counter($(major).$(minor))]

trigger: none
pr: none
  
stages:
- stage: AgentStart
  jobs:
  - job: AgentStartJob
    pool:
      name: At Home
    steps:
    - checkout: none
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'AzureConnection'
        scriptType: 'ps'
        scriptLocation: 'inlineScript'
        inlineScript: 'az vm start --resource-group CHR-RG-ABA-PRD-WE --name CHR-VM-ABA-PRD-WE'

- stage: Build
  jobs:
  - job: UWPBuild
    pool:
      name: uwp-agent
    steps:
    - template: apps/build.yml

- stage: AgentShutdown
  dependsOn: Build
  jobs:
  - job: AgentStutdownJob
    pool:
      vmImage: 'windows-latest'
    steps:
    - checkout: none
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'AzureConnection'
        scriptType: 'ps'
        scriptLocation: 'inlineScript'
        inlineScript: |
          az vm stop --resource-group CHR-RG-ABA-PRD-WE --name CHR-VM-ABA-PRD-WE
          az vm deallocate --resource-group CHR-RG-ABA-PRD-WE --name CHR-VM-ABA-PRD-WE

- stage: Release
  dependsOn: Build
  jobs:
  - job: ReleaseUWP
    pool:
      name: At Home
    steps:
    - template: apps/uwp-release.yml
  - job: ReleaseAndroid
    pool:
      name: At Home
    steps:
    - template: apps/android-release.yml